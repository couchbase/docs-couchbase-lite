:docname: troubleshooting-logs
:page-module: objc
:page-relative-src-path: troubleshooting-logs.adoc
:page-origin-url: https://github.com/couchbase/docs-couchbase-lite.git
:page-origin-start-path:
:page-origin-refname: antora-assembler-simplification
:page-origin-reftype: branch
:page-origin-refhash: (worktree)
[#objc:troubleshooting-logs:::]
=== Using Logs
:page-role:
:description: Couchbase Lite on Objective-C -- Using Logs for Troubleshooting



// BEGIN -- inclusion -- {module-partials}_define_module_attributes.adoc
//  Usage:  Here we define module specific attributes. It is invoked during the compilation of a page,
//          making all attributes available for use on the page.
//  UsedBy: ROOT:partial$_std_cbl_hdr.adoc

// BEGIN::module page attributes

//
// CBL-Obj-C Maintenance release number
//
:maintenance: 1
//

// VECTOR SEARCH attributes
//



// BEGIN - Set attributes pointing to API references for this module


// API Reference Links
//
//



// Supporting Data Type Classes



// DATABASE CLASSES


// Docuument Class




// Begin -- DatabaseConfiguration
// End -- DatabaseConfiguration

//Database.SAVE



//Database.DELETE


//Database.COMPACT
// deprecated 2.8
//
// :url-api-method-database-compact: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLDatabase.html#/c:objc(cs)CBLDatabase(im)compact:[CBLDatabase.compact()]






// QUERY RELATED CLASSES and METHODS

// Result Classes and Methods




// Query class and methods





// Expression class and methods
// :url-api-references-query-classes: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/[Query Class index]


// ArrayFunction class and methods


// Function class and methods
//

// Where class and methods
//
// https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLWhere.html
// NOT SET[Where]

// orderby class and methods
//
// https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLOrderBy.html

// GroupBy class and methods
//
// https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLGroupBy.html
// NOT SET[GroupBy]

// URLEndpointConfiguration





















// diag: Env+Module objc


// Replicator API











// Note there is a replicator.status property AND
// a ReplicationStatus class/struct --- oh yes, easy to confuse.

//:url-api-property-replicator-status-activity: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLReplicator.html#/s:18CouchbaseLiteobjc10ReplicatorC13ActivityLevelO







// ReplicatorConfiguration API











// Begin Replicator Retry Config
// End Replicator Retry Config


// :url-api-prop-replicator-config-ServerCertificateVerificationMode: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLReplicatorConfiguration.html#/c:objc(cs)CBLReplicatorConfiguration(py)serverCertificateVerificationMode[serverCertificateVerificationMode]

// :url-api-enum-replicator-config-ServerCertificateVerificationMode: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLReplicatorConfiguration.html{Enums/ServerCertificateVerificationMode.html[serverCertificateVerificationMode enum]








// Meta API




// BEGIN Logs and logging references
// :url-api-class-logging: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objcLogging.html[CBLLogging classes]







// END  Logs and logging references

// End define module specific attributes

// BEGIN::module page attributes
// :snippet-p2psync-ws: {snippets-p2psync-ws--objc}
// END::Local page attributes

// BEGIN -- inclusion/partial -- logging.adoc
// Used-by:
//    - ROOT:commons/common--database.adoc
//    - ROOT:partial$:<module>-troubleshooting-logs.adoc
// Uses: {snippets} -- various


// Begin required attributes
// :cbl-log-version: the required cbl-log version number (eg 2.7.0)
// snippet: the path to the language specific example code_snippets
// :fn-2x5: footnote content
//  End required attributes

// Begin -- Output an abstract unless this inclusion is being used as part of an encompassing page
// Allow for external over-ride of default content
[abstract]
--
Description -- _{description}_ +
Related Content -- xref:objc:troubleshooting-queries.adoc[Troubleshooting Queries] | xref:objc:troubleshooting-crashes.adoc[Decoding Crash Logs]
--
// End -- Output an abstract unless this inclusion is being used as part of an encompassing page


.Constraints
[NOTE]
--

* The retrieval of logs from the device is out of scope of this feature.
* This content applies to the post 2.5 versions.
If you are using a Couchbase Lite release prior to 2.5 see <<objc:troubleshooting-logs:::pre-2x5-logging,Deprecated functionality>>

--


// Begin text block
[discrete#objc:troubleshooting-logs:::introduction]
==== Introduction
Couchbase Lite provides a robust Logging API footnote:fn-2x5[From version 2.5] -- see: API References for https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html[CBLLog], https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLFileLogger.html[CBLFileLogger] and https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLogFileConfiguration.html[CBLLogFileConfiguration] -- which make debugging and troubleshooting easier during development and in production.
It delivers flexibility in terms of how logs are generated and retained, whilst also maintaining the level of logging required by Couchbase Support for investigation of issues.

Log output is split into the following streams:

* <<objc:troubleshooting-logs:::lbl-file-logs>>
+
Here logs are written to <<objc:troubleshooting-logs:::log-file-outputs,separate log files>> filtered by log level, with each log level supporting individual retention policies.

* <<objc:troubleshooting-logs:::lbl-console-logs>>
+
--
You can independently configure and control console logs, which provides a convenient method of accessing diagnostic information during debugging scenarios.
With console logging, you can fine-tune diagnostic output to suit specific debug scenarios, without interfering with any logging required by Couchbase Support for the investigation of issues.
--

* <<objc:troubleshooting-logs:::lbl-custom-logs>>
+
--
For greater flexibility you can implement a custom logging class using the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Protocols/CBLLogger.html[CBLLogger] interface.

--

In all instances, you control what is logged and at what level using the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html[CBLLog] class.

[discrete#objc:troubleshooting-logs:::lbl-console-logs]
==== Console based logging
Console based logging is often used to facilitate troubleshooting during development.

Console logs are your go-to resource for diagnostic information.
You can easily fine-tune their diagnostic content to meet the needs of a particular debugging scenario, perhaps by increasing the verbosity and-or choosing to focus on messages from a specific domain; to better focus on the problem area.

Changes to console logging are independent of file logging, so you can make change without compromising any files logging streams.
It is enabled by default.
To change default settings use database's https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html[CBLLog] method to set the required values -- see <<objc:troubleshooting-logs:::eg-cons-log>>

You will primarily use https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html#/c:objc(cs)CBLLog(py)console[CBLLog.console] and https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLConsoleLogger.html[CBLConsoleLogger] to control console logging.


[#eg-cons-log]
.Change Console Logging Settings
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#objc:troubleshooting-logs:::eg-cons-log]
====

This example enables and defines console-based logging settings.

// Show Main Snippet
[source, objc]
----
include ::objc:example$code_snippets/SampleCodeTest.m[tags="console-logging", indent=0]
CBLDatabase.log.console.domains = kCBLLogDomainAll; // <.>
CBLDatabase.log.console.level = kCBLLogLevelVerbose; // <.>

----




// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc
<.> Define the required domain ; here we turn on logging for all available domains -- see: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLConsoleLogger.html#/c:objc(cs)CBLConsoleLogger(py)domains[CBLLog.console.domains] and enum https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Enums/CBLLogDomain.html[CBLLogDomain]
<.> Here we turn on the most verbose log level -- see: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLConsoleLogger.html#/c:objc(cs)CBLConsoleLogger(py)level[CBLLog.console.level] and enum https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Enums/CBLLogLevel.html[CBLLogLevel]. +
To disable logging for the specified https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Enums/CBLLogDomain.html[CBLLogDomain] set the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Enums/CBLLogLevel.html[CBLLogLevel] to `None`.

Related::
https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html[CBLLog] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html#/c:objc(cs)CBLLog(py)console[CBLLog.console] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLConsoleLogger.html[CBLConsoleLogger]

[discrete#objc:troubleshooting-logs:::lbl-file-logs]
==== File based logging
File based logging is disabled by default --  see: <<objc:troubleshooting-logs:::eg-file-log>> for how to enable it.

You will primarily use https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html#/c:objc(cs)CBLLog(py)file[CBLLog.file] and https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLFileLogger.html[CBLFileLogger] to control file-based logging.

[discrete#objc:troubleshooting-logs:::formats]
===== Formats
Available file based logging formats:

* Binary -- most efficient for storage and performance. It is the default for file based logging.
+
Use this format and a decoder, such as *cbl-log*, to view them -- see: <<objc:troubleshooting-logs:::decoding-binary-logs>>.
* Plaintext

[discrete#objc:troubleshooting-logs:::configuration]
===== Configuration
As with console logging you can set the log level -- see:  the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLFileLogger.html[CBLFileLogger] class.

With file based logging you can also use the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLogFileConfiguration.html[CBLLogFileConfiguration] class's properties to specify the:

* log file path to the directory to store the log file
Once this limit is exceeded a new log file is started.
* log file format +
The default is _binary_.
You can over ride that where necessary and output a plain text log.
* maximum number of rotated log files to keep
* maximum size of the log file (bytes).

[#eg-file-log]
.Enabling file logging
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#objc:troubleshooting-logs:::eg-file-log]
====


// Show Main Snippet
[source, objc]
----
include ::objc:example$code_snippets/SampleCodeTest.m[tags="file-logging", indent=0]
NSString *tempFolder = [NSTemporaryDirectory() stringByAppendingPathComponent:@"cbllog"];
CBLLogFileConfiguration *config = [[CBLLogFileConfiguration alloc] initWithDirectory:tempFolder]; // <.>
config.maxRotateCount = 2; // <.>
config.maxSize = 1024; // <.>
config.usePlainText = YES; // <.>
[CBLDatabase.log.file setConfig:config];
[CBLDatabase.log.file setLevel:kCBLLogLevelInfo]; // <.>
----




// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc
<.> Set the log file directory
<.> Here we change the max rotation count from the default (1) to 5. +
*Note* this means six files may exist at any one time; the five rotated log files, plus the active log file
<.> Here we set the maximum size (bytes) for our log file
<.> Here we select the binary log format (included for reference only as this is the default)
<.> Here we increase the log output level from the default (_warnings_) to _info_ -- see: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLFileLogger.html#/c:objc(cs))CBLFileLogger(py)level[CBLLog.file.level: LogLevel]
+
*Note* that the use of https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLDatabase.html#/c:objc(cs)CBLDatabase(cm)setLogLevel:domain:[CBLDatabase.setLogLevel()] is now deprecated.
Further, you can no longer set a log level for a specific domain.

Related::
 https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html[CBLLog] |
https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html#/c:objc(cs)CBLLog(py)file[CBLLog.file] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLFileLogger.html[CBLFileLogger]

[discrete#objc:troubleshooting-logs:::lbl-custom-logs]
==== Custom logging

Couchbase Lite allows for the registration of a callback function to receive Couchbase Lite log messages, which may be logged using any external logging framework.

To do this, apps must implement the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Protocols/CBLLogger.html[CBLLogger] interface -- see <<objc:troubleshooting-logs:::eg-impl-log>> -- and enable custom logging using https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html#/c:objc(cs)CBLLog(py)custom[CBLLog.custom] -- see <<objc:troubleshooting-logs:::eg-cust-log>>.


[#eg-impl-log]
.Implementing logger interface
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#objc:troubleshooting-logs:::eg-impl-log]
====

pass:q,a[Here we introduce the code that implements the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Protocols/CBLLogger.html[CBLLogger] interface.]

// Show Main Snippet
[source, objc]
----
include ::objc:example$code_snippets/SampleCodeTest.m[tags="custom-logging", indent=0]
@interface LogTestLogger :NSObject<CBLLogger>

// set the log level
@property (nonatomic) CBLLogLevel level;

@end

@implementation LogTestLogger

@synthesize level=_level;

- (void) logWithLevel:(CBLLogLevel)level domain:(CBLLogDomain)domain message:(NSString*)message {
    // handle the message, for example piping it to
    // a third party framework
}

@end

----




// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc


[#eg-cust-log]
.Enabling custom logging
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#objc:troubleshooting-logs:::eg-cust-log]
====

pass:q,a[This example show how to enable the custom logger from <<objc:troubleshooting-logs:::eg-impl-log>>.]

// Show Main Snippet
[source, objc]
----
include ::objc:example$code_snippets/SampleCodeTest.m[tags="set-custom-logging", indent=0]
LogTestLogger *logger = [[LogTestLogger alloc] init];
logger.level = kCBLLogLevelWarning;
[CBLDatabase.log setCustom:logger];

----




// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc
<.> Here we set the custom logger with a level of 'warning'.
The custom logger is called with every log and may choose to filter it, using its configured level.


Related::
https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html[CBLLog] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Classes/CBLLog.html#/c:objc(cs)CBLLog(py)custom[CBLLog.custom] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-ios}{empty}/couchbase-lite-objc/Protocols/CBLLogger.html[CBLLogger]

[discrete#objc:troubleshooting-logs:::decoding-binary-logs]
==== Decoding binary logs

You can use the *cbl-log* tool to decode binary log files -- see <<objc:troubleshooting-logs:::eg-cbl-log>>.

[#objc:troubleshooting-logs:::eg-cbl-log]
.Using the cbl-log tool
=====
[tabs]
====

macOS::
+
--
Download the *cbl-log* tool using `wget`.

[source,console,subs="attributes"]
----
wget https://packages.couchbase.com/releases/couchbase-lite-log/{major}.{minor}.{base}{empty}/couchbase-lite-log-{major}.{minor}.{base}{empty}-macos.zip
----

Navigate to the *bin* directory and run the `cbl-log` executable.

[source,console]
----
$ ./cbl-log logcat LOGFILE <OUTPUT_PATH>
----
--


CentOS::
+
--
Download the *cbl-log* tool using `wget`.

[source,console, subs="attributes"]
----
wget https://packages.couchbase.com/releases/couchbase-lite-log/{major}.{minor}.{base}{empty}/couchbase-lite-log-{major}.{minor}.{base}{empty}-centos.zip
----

Navigate to the *bin* directory and run the `cbl-log` executable.

[source,console]
----
cbl-log logcat LOGFILE <OUTPUT_PATH>
----
--


Windows::
+
--
Download the *cbl-log* tool using PowerShell.

[source,powershell, subs="attributes"]
----
Invoke-WebRequest https://packages.couchbase.com/releases/couchbase-lite-log/{major}.{minor}.{base}{empty}/couchbase-lite-log-{major}.{minor}.{base}{empty}-windows.zip -OutFile couchbase-lite-log-{major}.{minor}.{base}{empty}-windows.zip
----

Run the `cbl-log` executable.

[source,powershell]
----
$ .\cbl-log.exe logcat LOGFILE <OUTPUT_PATH>
----
--
====
=====

// Begin - Output related content unless this inclusion is used as part of an encompassing page
// :param-add3-title: {empty}
// :param-reference: reference-p2psync


[discrete#objc:troubleshooting-logs:::related-content]
==== Related Content
++++
<div class="card-row three-column-row">
++++

[.column]
===== {empty}
.How to . . .
* xref:objc:querybuilder.adoc[QueryBuilder]
* xref:objc:query-n1ql-mobile.adoc[{sqlpp} for Mobile]
* xref:objc:query-live.adoc[Live Queries]
* xref:objc:fts.adoc[Full Text Search]


.

[discrete.colum#objc:troubleshooting-logs:::-2n]
===== {empty}
.Learn more . . .
* xref:objc:query-n1ql-mobile-querybuilder-diffs.adoc[{sqlpp} Mobile - Querybuilder  Differences]
* xref:objc:query-n1ql-mobile-server-diffs.adoc[{sqlpp} Mobile - {sqlpp} Server Differences]
* xref:objc:query-resultsets.adoc[Query Resultsets]
* xref:objc:query-troubleshooting.adoc[Query Troubleshooting]
* xref:objc:query-live.adoc[Live Queries]

* xref:objc:database.adoc[Databases]
* xref:objc:document.adoc[Documents]
* xref:objc:blob.adoc[Blobs]

.


[.column]
// [.content]
[discrete#objc:troubleshooting-logs:::-3]
===== {empty}
.Dive Deeper . . .
//* Community
https://forums.couchbase.com/c/mobile/14[Mobile Forum] |
https://blog.couchbase.com/[Blog] |
https://docs.couchbase.com/tutorials/[Tutorials]


.



++++
</div>
++++
// End - Output related content unless this inclusion is used as part of an encompassing page

// Begin -- Void any temporary parameters
// End -- Void any temporary parameters

// END -- inclusion/partial -- logging.adoc


