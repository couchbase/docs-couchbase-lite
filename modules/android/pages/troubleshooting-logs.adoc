:docname: troubleshooting-logs
:page-module: android
:page-relative-src-path: troubleshooting-logs.adoc
:page-origin-url: https://github.com/couchbase/docs-couchbase-lite.git
:page-origin-start-path:
:page-origin-refname: antora-assembler-simplification
:page-origin-reftype: branch
:page-origin-refhash: (worktree)
[#android:troubleshooting-logs:::]
=== Using Logs
:page-role:
:description: Couchbase Lite on Android -- Using Logs for Troubleshooting


// BEGIN -- inclusion/partial -- logging.adoc
// Used-by:
//    - ROOT:commons/common--database.adoc
//    - ROOT:partial$:<module>-troubleshooting-logs.adoc
// Uses: {snippets} -- various


// Begin required attributes
// :cbl-log-version: the required cbl-log version number (eg 2.7.0)
// snippet: the path to the language specific example code_snippets
// :fn-2x5: footnote content
//  End required attributes

// Begin -- Output an abstract unless this inclusion is being used as part of an encompassing page
// Allow for external over-ride of default content
[abstract]
--
Description -- _{description}_ +
Related Content -- xref:android:troubleshooting-queries.adoc[Troubleshooting Queries]
--
// End -- Output an abstract unless this inclusion is being used as part of an encompassing page


.Constraints
[NOTE]
--
* The value returned by `LogLevel.getValue()` is not the Android log level.
Do not use this API call.

* The retrieval of logs from the device is out of scope of this feature.
* This content applies to the post 2.5 versions.
If you are using a Couchbase Lite release prior to 2.5 see <<android:troubleshooting-logs:::pre-2x5-logging,Deprecated functionality>>

--


// Begin text block
[discrete#android:troubleshooting-logs:::introduction]
==== Introduction
Couchbase Lite provides a robust Logging API footnote:fn-2x5[From version 2.5] -- see: API References for https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Log.html[Log], https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/FileLogger.html[FileLogger] and https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/LogFileConfiguration.html[LogFileConfiguration(String directory)] -- which make debugging and troubleshooting easier during development and in production.
It delivers flexibility in terms of how logs are generated and retained, whilst also maintaining the level of logging required by Couchbase Support for investigation of issues.

Log output is split into the following streams:

* <<android:troubleshooting-logs:::lbl-file-logs>>
+
Here logs are written to <<android:troubleshooting-logs:::log-file-outputs,separate log files>> filtered by log level, with each log level supporting individual retention policies.

* <<android:troubleshooting-logs:::lbl-console-logs>>
+
--
You can independently configure and control console logs, which provides a convenient method of accessing diagnostic information during debugging scenarios.
With console logging, you can fine-tune diagnostic output to suit specific debug scenarios, without interfering with any logging required by Couchbase Support for the investigation of issues.
--

* <<android:troubleshooting-logs:::lbl-custom-logs>>
+
--
For greater flexibility you can implement a custom logging class using the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Logger.html[Logger] interface.

--

In all instances, you control what is logged and at what level using the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Log.html[Log] class.

[discrete#android:troubleshooting-logs:::lbl-console-logs]
==== Console based logging
Console based logging is often used to facilitate troubleshooting during development.

Console logs are your go-to resource for diagnostic information.
You can easily fine-tune their diagnostic content to meet the needs of a particular debugging scenario, perhaps by increasing the verbosity and-or choosing to focus on messages from a specific domain; to better focus on the problem area.

Changes to console logging are independent of file logging, so you can make change without compromising any files logging streams.
It is enabled by default.
To change default settings use database's https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Log.html[Log] method to set the required values -- see <<android:troubleshooting-logs:::eg-cons-log>>

You will primarily use https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/ConsoleLogger.html[log.getConsole()] and https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/ConsoleLogger.html[ConsoleLogger] to control console logging.

TIP: It can often be more effective to just use the Console logger (which logs to logcat). +
Note, a warning is displayed when you set continuous (file) logging *off*.

[#eg-cons-log]
.Change Console Logging Settings
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#android:troubleshooting-logs:::eg-cons-log]
====

This example enables and defines console-based logging settings.
// inject tab header
[{tabs}]
=====

[#android:troubleshooting-logs:::tabs-1-kotlin]
Kotlin::
+
--

// Show Main Snippet
[source, Kotlin]
----
include ::android:example$codesnippet_collection.kt[tags="console-logging", indent=0]
Database.log.console.domains = LogDomain.ALL_DOMAINS // <.>
Database.log.console.level = LogLevel.DEBUG // <.>
----

--
// Show Optional Alternate Snippet
[#android:troubleshooting-logs:::tabs-1-java]
Java::
+
--
[source, Java]
----
include ::android:example$codesnippet_collection.java[tags="console-logging", indent=0]
Database.log.getConsole().setLevel(LogLevel.DEBUG); // <.>
----
// Add tab closure
--

=====



// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc
<.> Define the required domain ; here we turn on logging for all available domains -- see: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/ConsoleLogger.html##setDomains-java.util.EnumSet-[log.getConsole().setDomain()] and enum https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/LogDomain.html[LogDomain]
<.> Here we turn on the most verbose log level -- see: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/ConsoleLogger.html#setLevel-com.couchbase.lite.LogLevel-[log.getConsole().setLevel()] and enum https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/LogLevel.html[LogLevel]. +
To disable logging for the specified https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/LogDomain.html[LogDomain] set the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/LogLevel.html[LogLevel] to `None`.

Related::
https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Log.html[Log] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/ConsoleLogger.html[log.getConsole()] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/ConsoleLogger.html[ConsoleLogger]

[discrete#android:troubleshooting-logs:::lbl-file-logs]
==== File based logging
File based logging is disabled by default --  see: <<android:troubleshooting-logs:::eg-file-log>> for how to enable it.

You will primarily use https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/FileLogger.html[log.getFile()] and https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/FileLogger.html[FileLogger] to control file-based logging.

[discrete#android:troubleshooting-logs:::formats]
===== Formats
Available file based logging formats:

* Binary -- most efficient for storage and performance. It is the default for file based logging.
+
Use this format and a decoder, such as *cbl-log*, to view them -- see: <<android:troubleshooting-logs:::decoding-binary-logs>>.
* Plaintext

[discrete#android:troubleshooting-logs:::configuration]
===== Configuration
As with console logging you can set the log level -- see:  the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/FileLogger.html[FileLogger] class.

With file based logging you can also use the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/LogFileConfiguration.html[LogFileConfiguration(String directory)] class's properties to specify the:

* log file path to the directory to store the log file
Once this limit is exceeded a new log file is started.
* log file format +
The default is _binary_.
You can over ride that where necessary and output a plain text log.
* maximum number of rotated log files to keep
* maximum size of the log file (bytes).

[#eg-file-log]
.Enabling file logging
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#android:troubleshooting-logs:::eg-file-log]
====

// inject tab header
[{tabs}]
=====

[#android:troubleshooting-logs:::tabs-2-kotlin]
Kotlin::
+
--

// Show Main Snippet
[source, Kotlin]
----
include ::android:example$codesnippet_collection.kt[tags="file-logging", indent=0]
Database.log.file.let {
    it.config = LogFileConfigurationFactory.newConfig(
        context.cacheDir.absolutePath, // <.>
        maxSize = 10240, // <.>
        maxRotateCount = 5, // <.>
        usePlainText = false
    ) // <.>
    it.level = LogLevel.INFO // <.>

----

--
// Show Optional Alternate Snippet
[#android:troubleshooting-logs:::tabs-2-java]
Java::
+
--
[source, Java]
----
include ::android:example$codesnippet_collection.java[tags="file-logging", indent=0]
LogFileConfiguration LogCfg = new LogFileConfiguration(
    (System.getProperty("user.dir") + "/MyApp/logs")); // <.>
LogCfg.setMaxSize(10240); // <.>
LogCfg.setMaxRotateCount(5); // <.>
LogCfg.setUsePlaintext(false); // <.>
Database.log.getFile().setConfig(LogCfg);
Database.log.getFile().setLevel(LogLevel.INFO); // <.>
----
// Add tab closure
--

=====



// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc
<.> Set the log file directory
<.> Here we change the max rotation count from the default (1) to 5. +
*Note* this means six files may exist at any one time; the five rotated log files, plus the active log file
<.> Here we set the maximum size (bytes) for our log file
<.> Here we select the binary log format (included for reference only as this is the default)
<.> Here we increase the log output level from the default (_warnings_) to _info_ -- see: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/FileLogger.html#setLevel-com.couchbase.lite.LogLevel-[log.getFile().setLevel()]
+
*Note* that the use of https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Database.html#setLogLevel-com.couchbase.lite.LogDomain-com.couchbase.lite.LogLevel-[Database.setLogLevel()] is now deprecated.
Further, you can no longer set a log level for a specific domain.

Related::
 https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Log.html[Log] |
https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/FileLogger.html[log.getFile()] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/FileLogger.html[FileLogger]

[discrete#android:troubleshooting-logs:::lbl-custom-logs]
==== Custom logging

Couchbase Lite allows for the registration of a callback function to receive Couchbase Lite log messages, which may be logged using any external logging framework.

To do this, apps must implement the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Logger.html[Logger] interface -- see <<android:troubleshooting-logs:::eg-impl-log>> -- and enable custom logging using https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Logger.html[log.setCustom()] -- see <<android:troubleshooting-logs:::eg-cust-log>>.


[#eg-impl-log]
.Implementing logger interface
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#android:troubleshooting-logs:::eg-impl-log]
====

pass:q,a[Here we introduce the code that implements the https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Logger.html[Logger] interface.]
// inject tab header
[{tabs}]
=====

[#android:troubleshooting-logs:::tabs-3-kotlin]
Kotlin::
+
--

// Show Main Snippet
[source, Kotlin]
----
include ::android:example$codesnippet_collection.kt[tags="custom-logging", indent=0]
class LogTestLogger(private val level: LogLevel) : Logger {
    override fun getLevel() = level

    override fun log(level: LogLevel, domain: LogDomain, message: String) {
        // this method will never be called if param level < this.level
        // handle the message, for example piping it to a third party framework
    }
}

----

--
// Show Optional Alternate Snippet
[#android:troubleshooting-logs:::tabs-3-java]
Java::
+
--
[source, Java]
----
include ::android:example$codesnippet_collection.java[tags="custom-logging", indent=0]
class LogTestLogger implements com.couchbase.lite.Logger {
    @NonNull
    private final LogLevel level;

    public LogTestLogger(@NonNull LogLevel level) { this.level = level; }

    @NonNull
    @Override
    public LogLevel getLevel() { return level; }

    @Override
    public void log(@NonNull LogLevel level, @NonNull LogDomain domain, @NonNull String message) {

    }
}
----
// Add tab closure
--

=====



// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc


[#eg-cust-log]
.Enabling custom logging
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#android:troubleshooting-logs:::eg-cust-log]
====

pass:q,a[This example show how to enable the custom logger from <<android:troubleshooting-logs:::eg-impl-log>>.]
// inject tab header
[{tabs}]
=====

[#android:troubleshooting-logs:::tabs-4-kotlin]
Kotlin::
+
--

// Show Main Snippet
[source, Kotlin]
----
include ::android:example$codesnippet_collection.kt[tags="set-custom-logging", indent=0]
// this custom logger will not log an event with a log level < WARNING
Database.log.custom = LogTestLogger(LogLevel.WARNING) // <.>
----

--
// Show Optional Alternate Snippet
[#android:troubleshooting-logs:::tabs-4-java]
Java::
+
--
[source, Java]
----
include ::android:example$codesnippet_collection.java[tags="set-custom-logging", indent=0]
Database.log.setCustom(new LogTestLogger(LogLevel.WARNING)); // <.>
----
// Add tab closure
--

=====



// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc
<.> Here we set the custom logger with a level of 'warning'.
The custom logger is called with every log and may choose to filter it, using its configured level.


Related::
https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Log.html[Log] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Logger.html[log.getCustom()] | https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-android}{empty}/couchbase-lite-android/com/couchbase/lite/Logger.html[Logger]

[discrete#android:troubleshooting-logs:::decoding-binary-logs]
==== Decoding binary logs

You can use the *cbl-log* tool to decode binary log files -- see <<android:troubleshooting-logs:::eg-cbl-log>>.

[#android:troubleshooting-logs:::eg-cbl-log]
.Using the cbl-log tool
=====
[{tabs}]
====
[#android:troubleshooting-logs:::tabs-5-macos]
macOS::
+
--
Download the *cbl-log* tool using `wget`.

[source,console,subs="attributes"]
----
wget https://packages.couchbase.com/releases/couchbase-lite-log/{major}.{minor}.{base}{empty}/couchbase-lite-log-{major}.{minor}.{base}{empty}-macos.zip
----

Navigate to the *bin* directory and run the `cbl-log` executable.

[source,console]
----
$ ./cbl-log logcat LOGFILE <OUTPUT_PATH>
----
--

[#android:troubleshooting-logs:::tabs-5-centos]
CentOS::
+
--
Download the *cbl-log* tool using `wget`.

[source,console, subs="attributes"]
----
wget https://packages.couchbase.com/releases/couchbase-lite-log/{major}.{minor}.{base}{empty}/couchbase-lite-log-{major}.{minor}.{base}{empty}-centos.zip
----

Navigate to the *bin* directory and run the `cbl-log` executable.

[source,console]
----
cbl-log logcat LOGFILE <OUTPUT_PATH>
----
--

[#android:troubleshooting-logs:::tabs-5-windows]
Windows::
+
--
Download the *cbl-log* tool using PowerShell.

[source,powershell, subs="attributes"]
----
Invoke-WebRequest https://packages.couchbase.com/releases/couchbase-lite-log/{major}.{minor}.{base}{empty}/couchbase-lite-log-{major}.{minor}.{base}{empty}-windows.zip -OutFile couchbase-lite-log-{major}.{minor}.{base}{empty}-windows.zip
----

Run the `cbl-log` executable.

[source,powershell]
----
$ .\cbl-log.exe logcat LOGFILE <OUTPUT_PATH>
----
--
====
=====

// Begin - Output related content unless this inclusion is used as part of an encompassing page
// :param-add3-title: {empty}
// :param-reference: reference-p2psync


[discrete#android:troubleshooting-logs:::related-content]
==== Related Content
++++
<div class="card-row three-column-row">
++++

[.column]
===== {empty}
.How to . . .
* xref:android:querybuilder.adoc[QueryBuilder]
* xref:android:query-n1ql-mobile.adoc[{sqlpp} for Mobile]
* xref:android:query-live.adoc[Live Queries]
* xref:android:fts.adoc[Full Text Search]


.

[discrete.colum#android:troubleshooting-logs:::-2n]
===== {empty}
.Learn more . . .
* xref:android:query-n1ql-mobile-querybuilder-diffs.adoc[{sqlpp} Mobile - Querybuilder  Differences]
* xref:android:query-n1ql-mobile-server-diffs.adoc[{sqlpp} Mobile - {sqlpp} Server Differences]
* xref:android:query-resultsets.adoc[Query Resultsets]
* xref:android:query-troubleshooting.adoc[Query Troubleshooting]
* xref:android:query-live.adoc[Live Queries]

* xref:android:database.adoc[Databases]
* xref:android:document.adoc[Documents]
* xref:android:blob.adoc[Blobs]

.


[.column]
// [.content]
[discrete#android:troubleshooting-logs:::-3]
===== {empty}
.Dive Deeper . . .
//* Community
https://forums.couchbase.com/c/mobile/14[Mobile Forum] |
https://blog.couchbase.com/[Blog] |
https://docs.couchbase.com/tutorials/[Tutorials]


.



++++
</div>
++++
// End - Output related content unless this inclusion is used as part of an encompassing page

// Begin -- Void any temporary parameters
// End -- Void any temporary parameters

// END -- inclusion/partial -- logging.adoc


