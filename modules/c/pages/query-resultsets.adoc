:docname: query-resultsets
:page-module: c
:page-relative-src-path: query-resultsets.adoc
:page-origin-url: https://github.com/couchbase/docs-couchbase-lite.git
:page-origin-start-path:
:page-origin-refname: antora-assembler-simplification
:page-origin-reftype: branch
:page-origin-refhash: (worktree)
[#c:query-resultsets:::]
=== Query Resultsets
:page-role:
:description: How to use Couchbase Lite Query's Result Sets
:keywords: query, sql, n1ql, fuzzy-matching



// BEGIN -- inclusion -- {module-partials}_define_module_attributes.adoc
//  Usage:  Here we define module specific attributes. It is invoked during the compilation of a page,
//          making all attributes available for use on the page.
//  UsedBy: ROOT:partial$_std_cbl_hdr.adoc

//
// CBL-C Maintenance release number
//
//

// VECTOR SEARCH attributes
//


// BEGIN - Set attributes pointing to API references for this module

//
//






// DATABASE module and functions
// Database(im)

// :url-api-method-database-compact: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-c}{empty}/couchbase-lite-c/C/html/group__database.html#gaa4b06dcb7427cafeabde8486f5f03f10[CBLDatabase_PerformMaintenance()]




// Begin -- DatabaseConfiguration
// End -- DatabaseConfiguration


// DOCUMENTS






// QUERY RELATED CLASSES and METHODS

// Result Classes and Methods




// Query class and methods





// Expression class and methods
// :url-api-references-query-classes: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-c}{empty}/couchbase-lite-c/C/html/group__[Query Class index]


// ArrayFunction class and methods


// Function class and methods
//

// Where class and methods
//
// https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-c}{empty}/couchbase-lite-c/C/html/group__Where.html
// NOT SET[Where]

// orderby class and methods
//
// https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-c}{empty}/couchbase-lite-c/C/html/group__OrderBy.html

// GroupBy class and methods
//
// https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-c}{empty}/couchbase-lite-c/C/html/group__GroupBy.html
// NOT SET[GroupBy]

// URLEndpointConfiguration





















// diag: Env+Module c


// Replicator API










// Note there is a replicator.status property AND
// a ReplicationStatus class/struct --- oh yes, easy to confuse.







// ReplicatorConfiguration API




// Repl Cfg Props







// Begin Replicator Retry Config
// End Replicator Retry Config


// :url-api-prop-replicator-config-ServerCertificateVerificationMode: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-c}{empty}/couchbase-lite-c/C/html/struct_c_b_l_replicator_configuration.html#(py)serverCertificateVerificationMode[serverCertificateVerificationMode]

// :url-api-enum-replicator-config-ServerCertificateVerificationMode: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-c}{empty}/couchbase-lite-c/C/html/struct_c_b_l_replicator_configuration.html{Enums/ServerCertificateVerificationMode.html[serverCertificateVerificationMode enum]







// CBLPropertyEncryptor gab116a23be8bd24b86349379f370ef60c
// CBLPropertyDecryptor ga24a60a3d6f9816e1d32464cc31a15c0c
// CBLEncryptable gaaf20d661f9684632a005f0a4e52656b3

// Meta API




// BEGIN Logs and logging references
// :url-api-class-logging: https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-c}{empty}/couchbase-lite-c/C/htmlLogging.html[CBLLogging classes]







// END  Logs and logging references

// End define module specific attributes

// BEGIN::module page attributes
// :snippet-p2psync-ws: {snippets-p2psync-ws--c}
// END::Local page attributes

[abstract]
--
Description -- _{description}_ +
Related Content -- xref:c:querybuilder.adoc[QueryBuilder] |  xref:c:query-n1ql-mobile.adoc[{sqlpp} for Mobile] |  xref:c:querybuilder.adoc#lbl-predquery[Predictive Queries] | xref:c:query-live.adoc[Live Queries] | xref:c:indexing.adoc[Indexing]
--

// BEGIN -- inclusion -- common-query-resultsets.adoc
//  Purpose -- describes the use of the query's resultset
//
// // BEGIN::REQUIRED EXTERNALS
// :this-module: {par-module}
// :this-lang-title: {par-lang-title}
// :this-packageNm: {par-packageNm}
// :this-source-language: {par-source-language}
// snippet: {par-snippet}
//:this-url-issues: {par-url-issues}
// END::REQUIRED EXTERNALS

// BEGIN::Local page attributes

// END::Local page attributes


[discrete#c:query-resultsets:::query-execution]
==== Query Execution
The execution of a Couchbase Lite for C's database query returns an array of results, a result set.

Each row of the result set represents the data returned from a document that met the conditions defined by the `WHERE` statement of your query.
The composition of each row is determined by the `SelectResult` expressions provided in the `SELECT` statement.


[discrete#c:query-resultsets:::lbl-process-resultset]
==== Processing Results
<<c:query-resultsets:::lbl-acc-all>>
| <<c:query-resultsets:::lbl-acc-id>>
| <<c:query-resultsets:::lbl-acc-specific>>

To retrieve the results of your query,  you need to execute it using `Query.execute`.

The output from the execution is an array, with each array element representing the data from a document that matched your search criteria.

To unpack the results you need to iterate through this array.
Alternatively, you can convert the result to a JSON string -- see:


[discrete#c:query-resultsets:::lbl-acc-all]
===== Access Document Properties - All Properties
Here we look at how to access document properties when you have used SelectResult.all.

In this case each array element is a dictionary structure with the database name as its key.
The properties are presented in the value as an array of key-value pairs (property name/property value).

You access the retrieved document properties by converting each row's value, in turn, to a dictionary -- as shown in <<c:query-resultsets:::ex-acc-all>>.

[#ex-acc-all]
.Access All Properties
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#c:query-resultsets:::ex-acc-all]
====


// Show Main Snippet
[source, c]
----
include ::c:example$code_snippets/main.cpp[tags="query-access-all", indent=0]
CBLResultSet* results = CBLQuery_Execute(query, &err);
while(CBLResultSet_Next(results)) {
    FLDict dict = FLValue_AsDict(CBLResultSet_ValueForKey(results, FLSTR("_")));

    FLString id = FLValue_AsString(FLDict_Get(dict, FLSTR("id")));
    FLString type = FLValue_AsString(FLDict_Get(dict, FLSTR("type")));
    FLString name = FLValue_AsString(FLDict_Get(dict, FLSTR("name")));
    FLString city = FLValue_AsString(FLDict_Get(dict, FLSTR("city")));

    printf("ID :: %.*s\n", (int)id.size, (const char *)id.buf);
    printf("Type :: %.*s\n", (int)type.size, (const char *)type.buf);
    printf("Name :: %.*s\n", (int)name.size, (const char *)name.buf);
    printf("City :: %.*s\n", (int)city.size, (const char *)city.buf);
}

// All results will be available from the above query
CBLResultSet_Release(results);
----




// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc
<.> Here we get the dictionary of document properties using the database name as the key.
You can add this dictionary to an array of returned matches, for processing elsewhere in the app.
<.> Alternatively, you can access the document properties here, by using the property names as keys to the dictionary object.

// ====
// [source, c, subs="+attributes, +macros"]
// ----
// let yourQuery = QueryBuilder.select(SelectResult.all)
//             .from(DataSource.database(yourDb))

// for dataRow in try yourQuery.execute() {
//   if let yourDoc = dict[dataRow.toDictionary()] as? [String:Any] {
//       let docid = yourDoc["id"]
//       let name = yourDoc["name"]
//       let type = yourDoc["type"]
//       let city = yourDoc["city"]
//   }
// }

// ----
// ====


[discrete#c:query-resultsets:::lbl-acc-id]
===== Access Document Properties - ID
Here we look at how to access document properties when you have returned only the document IDs for documents that matched your selection criteria.

This is something you may do when retrieval of the properties directly by the query may consume excessive amounts of memory and-or processing time.

In this case each array element is a dictionary structure where `ID` is the key and the required document ID is the value.

Access the required document properties by retrieving the document from the database using its document ID -- as shown in <<c:query-resultsets:::ex-acc-id>>.

[#ex-acc-id]
.Access by ID
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#c:query-resultsets:::ex-acc-id]
====


// Show Main Snippet
[source, c]
----
include ::c:example$code_snippets/main.cpp[tags="query-access-id", indent=0]
// NOTE: No error handling, for brevity (see getting started)

CBLResultSet* results = CBLQuery_Execute(query, &err);
while(CBLResultSet_Next(results)) {
    FLString id = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("id")));
    printf("Document ID :: %.*s\n", (int)id.size, (const char *)id.buf);
}
----




// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc
<.> Extract the Id value from the dictionary and use it to get the document from the database

// .Access Properties using Doc ID
// ====
// [source, c, subs="+attributes, +macros"]
// ----
// let yourQuery = QueryBuilder.select(SelectResult.expression(Meta.id))
//             .from(DataSource.database(yourDb))

// for dataRow in try yourQuery.execute() {
//   if let yourDocID = dict[dataRow["id"] {
//       let yourDoc = try yourDb.document(withID: yourDocId)
//       let name = yourDoc.name
//       let type = yourDoc.type
//       let city = yourDoc.city
//   }
// }

// ----
// ====


[discrete#c:query-resultsets:::lbl-acc-specific]
===== Access Document Properties - Selected Properties
Here we look at how to access properties when you have used SelectResult to get a specific subset of properties.

In this case each array element is an array of key value pairs (property name/property value).

Access the retrieved properties by converting each row into a dictionary -- as shown in <<c:query-resultsets:::ex-acc-specific>>.

[#ex-acc-specific]
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#c:query-resultsets:::ex-acc-specific]
====


// Show Main Snippet
[source, c]
----
include ::c:example$code_snippets/main.cpp[tags="query-access-props", indent=0]
// NOTE: No error handling, for brevity (see getting started)

CBLError err;
CBLQuery* query = CBLDatabase_CreateQuery(database, kCBLN1QLLanguage,
    FLSTR("SELECT type, name, city FROM _"), NULL, &err);

CBLResultSet* results = CBLQuery_Execute(query, &err);
while(CBLResultSet_Next(results)) {
    FLString type = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("type")));
    FLString name = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("name")));
    FLString city = FLValue_AsString(CBLResultSet_ValueForKey(results, FLSTR("city")));

    printf("Type :: %.*s\n", (int)type.size, (const char *)type.buf);
    printf("Name :: %.*s\n", (int)name.size, (const char *)name.buf);
    printf("City :: %.*s\n", (int)city.size, (const char *)city.buf);
}
----




// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc


// [#ex-acc-all]
// .Access All Properties
// ====
// [source, c, subs="+attributes, +macros"]
// ----
// let yoursearchQuery = QueryBuilder
//             .select(SelectResult.expression(Meta.id),
//                     SelectResult.expression(Expression.property("name")),
//                     SelectResult.expression(Expression.property("city")),
//                     SelectResult.expression(Expression.property("type")))
//             .from(DataSource.database(yourDb))

// for dataRow in try yourQuery.execute() {
//   if let yourDoc = dict[dataRow.toDictionary()] as? [String:Any] {
//       let docid = yourDoc["id"]
//       let name = yourDoc["name"]
//       let type = yourDoc["type"]
//   }
// }

// ----
// ====
// END -- inclusion -- common-query-resultsets.adoc

[discrete#c:query-resultsets:::json-result-sets]
==== JSON Result Sets

// Inclusion block
[#ex-json]
.Using JSON Results
// BEGIN inclusion -- block -- block_tabbed_code_example.adoc
//
//  Allows for abstraction of the showing of snippet examples
//  which makes displaying tabbed snippets for platforms with
//  more than one native language to show -- Android (Kotlin and Java)
//
// Surrounds code in Example block
//
//  PARAMETERS:
//    param-tags comma-separated list of tags to include/exclude
//    param-leader text for opening para of an example block
//
//  USE:
//    :param_tags: query-access-json
//    include::partial$block_show_snippet.adoc[]
//    :param_tags!:
//

[#c:query-resultsets:::ex-json]
====

pass:q,a[Use https://docs.couchbase.com/mobile/{major}.{minor}.{maintenance-c}{empty}/couchbase-lite-c/C/html/group__json.html#ga3450acc0690101545d75986b91e4080[FLValue_ToJSON()] to transform your result string into a JSON string, which can easily be serialized or used as required in your application. See <<c:query-resultsets:::ex-json>> for a working example.]

// Show Main Snippet
[source, c]
----
include ::c:example$code_snippets/main.cpp[tags="query-access-json", indent=0]
CBLResultSet* results = CBLQuery_Execute(query, &err);
while(CBLResultSet_Next(results)) {
    FLDict result = CBLResultSet_ResultDict(results);
    FLStringResult json = FLValue_ToJSON((FLValue)result);
    printf("JSON Result :: %.*s\n", (int)json.size, (const char *)json.buf);
    FLSliceResult_Release(json);
}
CBLResultSet_Release(results);

----




// close example block

====

// Tidy-up atttibutes created
// END -- block_show_snippet.doc

.JSON String Format
[#c:query-resultsets:::ex-json-format]
If your query selects ALL then the JSON format will be:

[source, JSON]
----
{
  database-name: {
    key1: "value1",
    keyx: "valuex"
  }
}
----

If your query selects a sub-set of available properties then the JSON format will be:

[source, JSON]
----
{
  key1: "value1",
  keyx: "valuex"
}
----

// :param-add3-title: {empty}
// :param-reference: reference-p2psync


[discrete#c:query-resultsets:::related-content]
==== Related Content
++++
<div class="card-row three-column-row">
++++

[.column]
===== {empty}
.How to . . .
* xref:c:gs-prereqs.adoc[Prerequisites]
* xref:c:gs-install.adoc[Install]
* xref:c:gs-build.adoc[Build and Run]


.

[discrete.colum#c:query-resultsets:::-2n]
===== {empty}
.Learn more . . .
* xref:c:database.adoc[Databases]
* xref:c:document.adoc[Documents]
* xref:c:blob.adoc[Blobs]
* xref:c:replication.adoc[Remote Sync Gateway]
* xref:c:conflict.adoc[Handling Data Conflicts]

.


[.column]
// [.content]
[discrete#c:query-resultsets:::-3]
===== {empty}
.Dive Deeper . . .
//* Community
https://forums.couchbase.com/c/mobile/14[Mobile Forum] |
https://blog.couchbase.com/[Blog] |
https://docs.couchbase.com/tutorials/[Tutorials]


.



++++
</div>
++++



