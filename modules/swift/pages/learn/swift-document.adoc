= Working with Documents
:page-layout: article
:page-status: {release-status-cbl} -- {release-comments-cbl}
:page-edition: Under Development
:page-role:

include::shared-mobile::partial$_attributes-shared.adoc[]
include::ROOT:partial$_page-index.adoc[]
include::ROOT:partial$_glossary-links.adoc[]
include::ROOT:partial$_attributes-local.adoc[]
include::{lang-mod-swift}:partial$_attributes-module.adoc[]


// BEGIN::Local page attributes
:blank-field: ____
:lang-title: {lang-title-swift}
:module: {lang-mod-swift}
:packageNm: couchbase-lite-{module}
:source-language: {lang-name-swift}
:snippet: {snippets-content--swift}
:url-issues: {url-github-cbl}{module}/issues
//:url-api-references: http://docs.couchbase.com/mobile/2.7.0/couchbase-lite-swift

//:version: 2.7.{snippet}
//:xref-pfx-sgw: {xref-pfx-sgw}:
//:ziputils: ROOT:example$/java-android/app/src/main/java/com/couchbase/code_snippets/ZipUtils.java
//:url-api-references: http://docs.couchbase.com/mobile/{version}/couchbase-lite-android
//:snippet: ROOT:example$/java-android/app/src/main/java/com/couchbase/code_snippets/Examples.java

// END::Local page attributes


== Overview

In Couchbase Lite, a document's body takes the form of a JSON object--a collection of key/value pairs where the values can be different types of data such as numbers, strings, arrays or even nested objects.
Every document is identified by a document ID, which can be automatically generated (as a UUID) or specified programmatically;
the only constraints are that it must be unique within the database, and it can't be changed.

== Initializers

The following methods/initializers can be used:

* The `MutableDocument()` initializer can be used to create a new document where the document ID is randomly generated by the database.
* The `MutableDocument(withID: String)` initializer can be used to create a new document with a specific ID.
* The `database.document(withID: String)` method can be used to get a document.
If it doesn't exist in the database, it will return `nil`.
This method can be used to check if a document with a given ID already exists in the database.

The following code example creates a document and persists it to the database.

[source]
----
include::{snippet}[tag=initializer,indent=0]
----

== Mutability

By default, when a document is read from the database it is immutable.
The `document.toMutable()` method should be used to create an instance of the document which can be updated.

[source]
----
include::{snippet}[tag=update-document,indent=0]
----

Changes to the document are persisted to the database when the `saveDocument` method is called.

== Typed Accessors

The `Document` class now offers a set of {url-api-references}/Classes/Document.html#/DictionaryProtocol[`property accessors`] for various scalar types, including boolean, integers, floating-point and strings.
These accessors take care of converting to/from JSON encoding, and make sure you get the type you're expecting.

In addition, as a convenience we offer `Date` accessors.
Dates are a common data type, but JSON doesn't natively support them, so the convention is to store them as strings in ISO-8601 format.
The following example sets the date on the `createdAt` property and reads it back using the `document.date(forKey: String)` accessor method.

[source]
----
include::{snippet}[tag=date-getter,indent=0]
----

If the property doesn't exist in the document it will return the default value for that  getter method (0 for `getInt`, 0.0 for `getFloat` etc.).

If you need to determine whether a given property exists in the document, you should use the {url-api-references}/Classes/Document.html#/s:18CouchbaseLiteSwift8DocumentC8containsSbSS3key_tF[`Document.Contains(key: String)`] method.

A `Document` can be converted to a plain dictionary type.
That's often useful to pass the document contents as a plain object to another method.

[source]
----
include::{snippet}[tag=to-dictionary,indent=0]
----

== Batch operations

If you're making multiple changes to a database at once, it's faster to group them together.
The following example persists a few documents in batch.

[source]
----
include::{snippet}[tag=batch,indent=0]
----

At the *local* level this operation is still transactional: no other `Database` instances, including ones managed by the replicator can make changes during the execution of the block, and other instances will not see partial changes.
But Couchbase Mobile is a distributed system, and due to the way replication works, there's no guarantee that Sync Gateway or other devices will receive your changes all at once.

== Document change events

It's also possible to register for document changes.
The following example registers for changes to the document with ID `user.john` and prints the `verified_account` property.

[source]
----
include::{snippet}[tag=document-listener,indent=0]
----

== Document Expiration

include::{root-partials}document-expiration.adoc[]

